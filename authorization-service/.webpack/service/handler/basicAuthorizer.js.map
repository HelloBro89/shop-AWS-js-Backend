{"version":3,"file":"handler/basicAuthorizer.js","mappings":";;UAAA;UACA;;;;;WCDA;WACA;WACA;WACA;WACA,yCAAyC,wCAAwC;WACjF;WACA;WACA;;;;;WCPA;;;;;WCAA;WACA;WACA;WACA,uDAAuD,iBAAiB;WACxE;WACA,gDAAgD,aAAa;WAC7D;;;;;;;;;ACNa;;AAEb,MAAMA,cAAc,GAAG,CAACC,WAAD,EAAcC,QAAd,EAAwBC,MAAxB,MAAoC;AACvDF,EAAAA,WADuD;AAEvDG,EAAAA,cAAc,EAAE;AACZC,IAAAA,OAAO,EAAE,YADG;AAEZC,IAAAA,SAAS,EAAE,CACP;AACIC,MAAAA,MAAM,EAAE,oBADZ;AAEIC,MAAAA,QAAQ,EAAEN,QAFd;AAGIO,MAAAA,MAAM,EAAEN;AAHZ,KADO;AAFC;AAFuC,CAApC,CAAvB;;AAcO,MAAMO,eAAe,GAAI,OAAOC,KAAP,EAAcC,OAAd,EAAuBC,QAAvB,KAAoC;AAChEC,EAAAA,OAAO,CAACC,GAAR,CAAY,+BAAZ,EAA6CJ,KAA7C;;AAEA,MAAIA,KAAK,CAACK,IAAN,KAAe,OAAnB,EAA4B;AACxBH,IAAAA,QAAQ,CAAC,cAAD,CAAR;AACH;;AAAA;;AAED,MAAI;AACA,UAAMI,OAAO,GAAGN,KAAK,CAACO,kBAAN,CAAyBC,KAAzB,CAA+B,GAA/B,EAAoC,CAApC,CAAhB;AACAL,IAAAA,OAAO,CAACC,GAAR,CAAa,wBAAuBE,OAAQ,EAA5C;AACA,UAAMG,IAAI,GAAGC,MAAM,CAACC,IAAP,CAAYL,OAAZ,EAAqB,QAArB,CAAb;AACA,UAAM,CAAEM,QAAF,EAAYC,QAAZ,IAAyBJ,IAAI,CAACK,QAAL,CAAc,OAAd,EAAuBN,KAAvB,CAA6B,GAA7B,CAA/B;AACA,UAAMO,cAAc,GAAGC,OAAO,CAACC,GAAR,CAAYL,QAAZ,CAAvB;AACAT,IAAAA,OAAO,CAACC,GAAR,CAAa,2BAA0BQ,QAAS,EAAhD;AACAT,IAAAA,OAAO,CAACC,GAAR,CAAa,iCAAgCW,cAAe,EAA5D;AACAZ,IAAAA,OAAO,CAACC,GAAR,CAAa,2BAA0BS,QAAS,EAAhD;AACA,UAAMrB,MAAM,GAAG,CAACuB,cAAD,IAAmBA,cAAc,KAAKF,QAAtC,GAAiD,MAAjD,GAA0D,OAAzE;AACAV,IAAAA,OAAO,CAACC,GAAR,CAAa,yBAAwBZ,MAAO,EAA5C;AACA,UAAM0B,MAAM,GAAG7B,cAAc,CAACiB,OAAD,EAAUN,KAAK,CAACmB,SAAhB,EAA2B3B,MAA3B,CAA7B;AACAW,IAAAA,OAAO,CAACC,GAAR,CAAa,iBAAgBgB,IAAI,CAACC,SAAL,CAAeH,MAAf,CAAuB,EAApD;AACAhB,IAAAA,QAAQ,CAAC,IAAD,EAAOgB,MAAP,CAAR;AACH,GAdD,CAcE,OAAOI,CAAP,EAAU;AACRnB,IAAAA,OAAO,CAACC,GAAR,CAAa,sBAAqBkB,CAAE,EAApC;AACApB,IAAAA,QAAQ,CAAE,iBAAgBoB,CAAC,CAACC,OAAQ,EAA5B,CAAR;AACH;AACJ,CAzBM,C","sources":["webpack://authorization-service/webpack/bootstrap","webpack://authorization-service/webpack/runtime/define property getters","webpack://authorization-service/webpack/runtime/hasOwnProperty shorthand","webpack://authorization-service/webpack/runtime/make namespace object","webpack://authorization-service/./handler/basicAuthorizer.js"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","'use strict';\n\nconst generatePolicy = (principalId, resource, effect) => ({\n    principalId,\n    policyDocument: {\n        Version: '2012-10-17',\n        Statement: [\n            {\n                Action: 'execute-api:Invoke',\n                Resource: resource,\n                Effect: effect,\n            }\n        ]\n    }\n});\n\nexport const basicAuthorizer  = async (event, context, callback) => {\n    console.log(\"**********Get logs of event: \", event);\n\n    if (event.type !== 'TOKEN') {\n        callback('Unauthorized')\n    };\n\n    try {\n        const encoded = event.authorizationToken.split(' ')[1];\n        console.log(`******CHECK encoded: ${encoded}`);\n        const buff = Buffer.from(encoded, 'base64');\n        const [ username, password ] = buff.toString('utf-8').split(':');\n        const storedPassword = process.env[username];\n        console.log(`********CHECK username: ${username}`);\n        console.log(`********CHECK storedPassword: ${storedPassword}`);\n        console.log(`********CHECK PASSWORD: ${password}`);\n        const effect = !storedPassword || storedPassword !== password ? 'Deny' : 'Allow';\n        console.log(`********CHECK EFFECT: ${effect}`);\n        const policy = generatePolicy(encoded, event.methodArn, effect);\n        console.log(`CHECK POLICY: ${JSON.stringify(policy)}`);\n        callback(null, policy);\n    } catch (e) {\n        console.log(`*******CHECK ERROR ${e}`);\n        callback(`Unauthorized: ${e.message}`);\n    }\n};\n\n\n\n\n"],"names":["generatePolicy","principalId","resource","effect","policyDocument","Version","Statement","Action","Resource","Effect","basicAuthorizer","event","context","callback","console","log","type","encoded","authorizationToken","split","buff","Buffer","from","username","password","toString","storedPassword","process","env","policy","methodArn","JSON","stringify","e","message"],"sourceRoot":""}