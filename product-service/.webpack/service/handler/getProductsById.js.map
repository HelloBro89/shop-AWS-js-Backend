{"version":3,"file":"handler/getProductsById.js","mappings":";;UAAA;UACA;;;;;WCDA;WACA;WACA;WACA;WACA,yCAAyC,wCAAwC;WACjF;WACA;WACA;;;;;WCPA;;;;;WCAA;WACA;WACA;WACA,uDAAuD,iBAAiB;WACxE;WACA,gDAAgD,aAAa;WAC7D;;;;;;;;;;;;;;ACNA,MAAM,2BAA4B;;ACAd;AACpB,QAAQ,SAAS,EAAE,2BAAE;AACrB;AACA,QAAQ,0DAA0D;AAClE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;;;AChBa;AACiD;AAC9D;AACO;AACP,qBAAqB,MAAM,CAAC,SAAS;AACrC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0DAA0D,OAAO;AACjE;AACA,WAAW,mBAAmB,4IAA4I,OAAO;AACjL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP,4BAA4B,6BAA6B;AACzD;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP,6BAA6B,mCAAmC;AAChE;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA,E","sources":["webpack://product-service/webpack/bootstrap","webpack://product-service/webpack/runtime/define property getters","webpack://product-service/webpack/runtime/hasOwnProperty shorthand","webpack://product-service/webpack/runtime/make namespace object","webpack://product-service/external \"pg\"","webpack://product-service/./handler/connection/connection.mjs","webpack://product-service/./handler/getProductsById.mjs"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"pg\");","import PG from 'pg';\r\nconst { Client } = PG;\r\n\r\nconst { PG_HOST, PG_PORT, PG_DATABASE, PG_USERNAME, PG_PASSWORD } = process.env;\r\n\r\nconst dbOptions = {\r\n   host: PG_HOST,\r\n   port: PG_PORT,\r\n   database: PG_DATABASE,\r\n   user: PG_USERNAME,\r\n   password: PG_PASSWORD,\r\n   ssl: {\r\n      rejectUnauthorized: false\r\n   },\r\n   connectionTimeoutMillis: 5000\r\n};\r\n\r\nexport {dbOptions, Client}","'use strict';\r\nimport {dbOptions, Client} from './connection/connection.mjs';\r\n\r\nexport const getProductsById = async event => {\r\n  const client = new Client(dbOptions);\r\n  await client.connect();\r\n\r\n  console.log(\"***********Get product by ID: \", event);\r\n  \r\n \r\n  try {\r\n    const params = await event.pathParameters.productId;\r\n    \r\n    console.log(`***********Get params of request. Id = ${params}`);\r\n\r\n    const {rows: productById} = await client.query(`select id, count, price, title, description from products p left join stocks s on p.id = s.product_id where id in ('${params}')`);\r\n    \r\n    console.log(\"************ TESTESTESTSETSETSETSE\", productById[0]);\r\n\r\n    if (productById[0]) {\r\n      return {\r\n        statusCode: 200,\r\n        headers: {\r\n          'Access-Control-Allow-Origin': '*',\r\n          'Access-Control-Allow-Credentials': true,\r\n          },\r\n          body: JSON.stringify(productById[0]),\r\n         };\r\n      }  \r\n        return {\r\n      statusCode: 404,\r\n      headers: {\r\n        'Access-Control-Allow-Origin': '*',\r\n        'Access-Control-Allow-Credentials': true,\r\n      },\r\n      body: JSON.stringify({message: 'Product not found'}),\r\n    };\r\n      \r\n   } catch (e) {\r\n     \r\n    //  console.log(\"***********Error: \", e);\r\n\r\n     if (/* e.name === 'SyntaxError' || e.code === '42703' || */ e.code === '22P02') {\r\n      console.log(\"*****Error SyntaxError: \", e);\r\n      return {\r\n          statusCode: 400,\r\n          headers: {\r\n              'Access-Control-Allow-Origin': '*',\r\n              'Access-Control-Allow-Credentials': true,\r\n      },\r\n       body: JSON.stringify({message: \"Product data is invalid\"}),\r\n   };\r\n  } else {\r\n    console.log(\"*****Error : \", e);\r\n      return {\r\n      statusCode: 500,\r\n      headers: {\r\n      'Access-Control-Allow-Origin': '*',\r\n      'Access-Control-Allow-Credentials': true,\r\n    },\r\n    body: JSON.stringify({\r\n       message: \"unexpected error\"\r\n    }),\r\n }\r\n  }\r\n   \r\n  \r\n\r\n    \r\n     } finally {\r\n      client.end()\r\n    }\r\n  }\r\n  "],"names":[],"sourceRoot":""}